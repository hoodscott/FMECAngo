{% extends 'fmecango/base.html' %}
{% load static %}

{% block title_block %}table.name{% endblock %}</title>

{% block body_block%}
    <div class="container">
      <div class="row">
        <div class="col-md-12 well">
          <h1>{{ table.name|capfirst }}</h1>
          {% if table.diagram %}
          <img alt="block diagram" title="block diagram" src="../media/{{ table.diagram }}"/>
          {% endif %}
        </div>
      
        {% if components %}
        <div class="col-md-12 well">
          <table id="theTable" class="display table table-striped table-bordered" cellspacing="0" width="90%" style="table-layout: fixed;word-break: normal|break-all">
            <thead>
              <tr>
                <th>Component Name</th>
                <th>Function</th>
                <th>Failure Mode</th>
                <th>Cause of Failure</th>
                <th>Effect of Failure</th>
                <th>Severity</th>
                <th>Occurence</th>
                <th>Detection</th>
                <th>Risk</th>
                <th>Notes</th>
              </tr>
            </thead>
            
            <tbody>
            {% for component in components %}
              {% for fault in component.failuremode_set.all %}
                <tr>
                  <td>{{ component.name }}</td>
                  <td>{{ component.function }}</td>
                  <td>{{ fault.name }}</td>
                  <td>{{ fault.cause }}</td>
                  <td>{{ fault.effect }}</td>
                  <td>{{ fault.severity }}</td>
                  <td>{{ fault.occurence }}</td>
                  <td>{{ fault.detection }}</td>
                  <td>{{ fault.risk }}</td>
                  <td>{{ fault.notes }}</td>
                </tr>
              {% empty %}
                <tr>
                  <td>{{ component.name }}</td>
                  <td>{{ component.function }}</td>
                </tr>
              {% endfor %}
            {% endfor %}
            </tbody>
          </table>
          <br>
        
        {% else %}
          <div class="col-md-12 well "><h3>No components have been added</h3>
        {% endif %}
      
    style
    open modal on error
    
    <!-- Trigger the modal with a button -->
    <button type="button" class="btn btn-info btn-lg pull-left" data-toggle="modal" data-target="#componentModal">Add Component</button>
  
    <!-- Modal -->
    <div id="componentModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
    
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">New Component</h4>
          </div>
          <div class="modal-body">
                
            <form role="form" action="{% url 'table' table.slug %}" method="post" class="form-horizontal">
              {% for hidden in component_form.hidden %}
              {{ hidden }}
              {% endfor %}
              
              {% csrf_token %}
              <div class="form-group">
                <label class="control-label col-sm-4" for="name">Name of Component:</label>
                <div class="col-sm-8">
                  {{ component_form.name }}{{ component_form.name.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="description">Brief Description of its purpose:</label>
                <div class="col-sm-8">
                  {{ component_form.function }}{{ component_form.function.errors }}
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                  <button type="submit" name="component" class="btn btn-default">Submit</button>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    
    
    {% if components %}
    <!-- Trigger the modal with a button -->
    <button type="button" class="btn btn-info btn-lg pull-right" data-toggle="modal" data-target="#failureModal">Add Failure Mode</button>
  
    <!-- Modal -->
    <div id="failureModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
    
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">New Failure Mode</h4>
          </div>
          <div class="modal-body">
                
            <form role="form" action="{% url 'table' table.slug %}" method="post" class="form-horizontal">
              {% for hidden in failuremode_form.hidden %}
              {{ hidden }}
              {% endfor %}
              
              {% csrf_token %}
              <div class="form-group">
                <label class="control-label col-sm-4" for="email">Component</label>
                <div class="col-sm-8">
                  {{ failuremode_form.component }}{{ failuremode_form.component.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="email">Name of Failure Mode:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.name }}{{ failuremode_form.name.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Cause of Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.cause }}{{ failuremode_form.cause.errors }}
                </div>
              </div>
                    <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Effect of Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.effect }}{{ failuremode_form.effect.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Severity of Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.severity }}{{ failuremode_form.severity.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Occurence of Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.occurence }}{{ failuremode_form.occurence.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Detection of Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.detection }}{{ failuremode_form.detection.errors }}
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-4" for="pwd">Notes on Failure:</label>
                <div class="col-sm-8">
                  {{ failuremode_form.notes }}{{ failuremode_form.notes.errors }}
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                  <button type="submit" name="failuremode" class="btn btn-default">Submit</button>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
    
      </div>
    </div>
    {% endif %}
          </div>
    </div>
    
{% endblock %}
    
{% block js_block %}
<script>
$(document).ready(function() {
  $('#theTable').DataTable( {
    columnDefs: [{targets: [1,3,4,-1],  width: '10vw'},{targets: [0,2,5,6,7,8],  width: '7vw'}],
    scrollX: true,
    scrollY: '75vh',
    scrollCollapse: true,
    paging: false,
    order: [[ 0, "desc" ], [8, "desc"]],
    fixedColumns: {leftColumns: 2},
    
  } );
} );
</script>
{% endblock %}